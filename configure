#!/bin/bash

# [Previous checks and configurations remain the same]

# Create Makefile
cat > Makefile << EOF
# Compiler
CXX := g++

# FMOD API path
FMOD_PATH := $FMOD_PATH

# Installation path
INSTALL_PATH := /usr/local/lemmings

# Compiler flags
CXXFLAGS := -std=c++11 -Wall -Wextra \\
    -I\$(FMOD_PATH)/api/core/inc \\
    -I\$(FMOD_PATH)/api/studio/inc \\
    \$(shell pkg-config --cflags glut glew gl glu) \\
    $SOIL_CFLAGS

# Linker flags
LDFLAGS := \\
    -L\$(FMOD_PATH)/api/core/lib/$FMOD_LIB_PATH \\
    -L\$(FMOD_PATH)/api/studio/lib/$FMOD_LIB_PATH

# Libraries
LIBS := -lfmod -lfmodstudio \$(shell pkg-config --libs glut glew gl glu) $SOIL_LIBS

# Source directory
SRC_DIR := src

# Object directory
OBJ_DIR := obj

# Source files
SRCS := \$(wildcard \$(SRC_DIR)/*.cpp)

# Object files
OBJS := \$(SRCS:\$(SRC_DIR)/%.cpp=\$(OBJ_DIR)/%.o)

# Executable name
EXEC := lemmings

# Main target
\$(EXEC): \$(OBJS)
	\$(CXX) \$(OBJS) -o \$(EXEC) \$(LDFLAGS) \$(LIBS)

# Rule for object files
\$(OBJ_DIR)/%.o: \$(SRC_DIR)/%.cpp
	@mkdir -p \$(OBJ_DIR)
	\$(CXX) \$(CXXFLAGS) -c \$< -o \$@

# Install target
install: \$(EXEC)
	install -d \$(INSTALL_PATH)
	install -m 755 \$(EXEC) \$(INSTALL_PATH)
	install -m 644 \$(FMOD_PATH)/api/core/lib/$FMOD_LIB_PATH/libfmod.so* \$(INSTALL_PATH)
	install -m 644 \$(FMOD_PATH)/api/studio/lib/$FMOD_LIB_PATH/libfmodstudio.so* \$(INSTALL_PATH)
	cp -R Game \$(INSTALL_PATH)
	@echo "Creating launch script..."
	@echo '#!/bin/bash' > /usr/local/bin/lemmings
	@echo 'cd \$(INSTALL_PATH) && LD_LIBRARY_PATH=\$(INSTALL_PATH) ./lemmings' >> /usr/local/bin/lemmings
	chmod +x /usr/local/bin/lemmings

# Clean rule
clean:
	rm -rf \$(OBJ_DIR) \$(EXEC)

# Uninstall target
uninstall:
	rm -rf \$(INSTALL_PATH)
	rm -f /usr/local/bin/lemmings

# Phony targets
.PHONY: clean install uninstall
EOF

echo "Configuration complete. Makefile has been created."
echo "You can now run 'make' to build the project."
echo "After building, run 'sudo make install' to install the game."

